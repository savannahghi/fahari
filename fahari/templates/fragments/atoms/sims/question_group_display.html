{% load static i18n compress %}
{% load questionnaire_responses %}
{% with question_group|is_not_applicable_for_questionnaire:object as not_applicable %}
<div class="accordion my-2" id="acc_qg_{{ question_group.pk }}">
    <div class="card border border-secondary rounded-7">
        <div class="card-header row">
            <h2 class="mb-0 col">
                <button
                        class="btn btn-link text-left"
                        data-toggle="collapse"
                        data-target="#clp_{{ question_group.pk }}"
                        {% if not_applicable %} disabled {% endif %}
                        id="clp_toggle_{{ question_group.pk }}"
                        type="button"
                        style="outline: none !important; box-shadow: none;"
                >
                    {{ question_group.precedence }}. {{ question_group.title }}
                </button>
            </h2>
            <div class="col mb-0 ml-auto d-flex flex-row-reverse">
                <div class="form-check form-check-inline">
                    {% if question_group.is_answerable %}
                    <input
                            class="form-check-input applicability_toggle"
                            type="checkbox"
                            {% if not not_applicable %} checked {% endif %}
                            data-is_applicable="tgl_applicable:::{{ question_group.pk }}"
                            data-mark_as_applicable="{% url 'api:questionnaireresponses-mark-question-group-as-applicable' object.pk %}"
                            data-mark_as_non_applicable="{% url 'api:questionnaireresponses-mark-question-group-as-non-applicable' object.pk %}"
                            data-on="Applicable"
                            data-onstyle="outline-primary"
                            data-off="N/A"
                            data-offstyle="secondary"
                            data-question_group="{{ question_group.pk }}"
                            data-size="sm"
                            data-toggle="toggle"
                            data-width="100"
                    >
                    {% endif %}
                </div>
                <div id="spn_spinner_question_group_{{ question_group.pk }}" class="spinner-border text-primary mr-2 d-none" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
            </div>
        </div>
        <div id="clp_{{ question_group.pk }}" class="collapse" data-parent="#acc_qg_{{ question_group.pk }}">
            <div class="card-body">
                {% if question_group.is_parent %}
                    {% with question_group as parent %}
                        {% for question_group in parent.sub_question_groups.active.by_precedence %}
                            {% include "fragments/atoms/sims/question_group_display.html" %}
                        {% endfor %}
                    {% endwith %}
                {% else %}
                <form id="question_group_form_{{ question_group.pk }}" class="question_group_answers_form">
                    {% for question in question_group.direct_decedents_only.active.by_precedence %}
                        {% include "fragments/atoms/sims/question_display.html" %}
                    {% endfor %}
                    <div class="row">
                        <div class="col-sm-1"></div>
                        <div class="col-sm-11">
                            <button
                                    type="button"i
                                    class="btn btn-primary save_changes"
                                    data-question_group="{{ question_group.pk }}"
                                    data-save_changes_url="{% url 'api:questionnaireresponses-save-question-group-answers' object.pk  %}"
                                    id="btn_save_changes_{{ question_group.pk }}"
                            >
                                Save Changes
                            </button>
                        </div>
                    </div>
                </form>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endwith %}
